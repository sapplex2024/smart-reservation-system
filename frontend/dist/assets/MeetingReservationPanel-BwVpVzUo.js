import{d as oe,r as y,P as ie,c as re,o as de,a as p,e as n,w as o,E as ce,f as ue,g as F,h as z,b as s,Q as _e,R as ve,z as i,F as S,B as T,S as B,k as E,T as M,q as me,v as pe,t as q,x as fe,m as u,A as ge,l as be,G as he,j as we,U as De,V as ye,n as Ce,W as ke,X as Re,O as _,_ as Se}from"./index-C-Q3ynzh.js";const Te={class:"meeting-reservation-panel"},Ee={class:"panel-header"},Me={class:"header-actions"},$e={class:"stats-section"},xe={class:"stat-card"},Ve={class:"stat-number"},Ye={class:"stat-card"},Pe={class:"stat-number"},ze={class:"stat-card"},Be={class:"stat-number"},Ne={class:"stat-card"},He={class:"stat-number"},Ie={class:"timeline-section"},Le={class:"timeline-container"},je={class:"time-axis"},Ae={class:"time-label"},Oe={class:"rooms-timeline"},Ue={class:"room-info"},Fe={class:"room-name"},qe={class:"room-capacity"},Ge={class:"timeline-slots"},Qe=["onClick"],We=["title"],Xe={class:"reservation-title"},Je={class:"reservation-time"},Ke={class:"reservations-list"},Ze={key:0,class:"reservation-detail"},et={key:0,class:"description-section"},tt={key:1,class:"participants-section"},st=oe({__name:"MeetingReservationPanel",setup(at){const $=y(!1),f=y(new Date().toISOString().split("T")[0]),D=y([]),C=y([]),x=y(!1),c=y(null),g=ie({total:0,confirmed:0,inProgress:0,available:0}),N=Array.from({length:15},(t,e)=>e+8),G=re(()=>{const t=f.value;return D.value.filter(e=>e.start_time.split("T")[0]===t)}),k=async()=>{$.value=!0;try{const t=await F.get("/api/v1/reservations/",{params:{start_date:f.value,end_date:f.value,size:100}});D.value=t.data.items||[],H()}catch(t){console.error("加载预约数据失败:",t),z.error("加载预约数据失败")}finally{$.value=!1}},Q=async()=>{try{const t=await F.get("/api/resources/",{params:{resource_type:"meeting_room",limit:50}});C.value=t.data||[],H()}catch(t){console.error("加载会议室数据失败:",t),z.error("加载会议室数据失败")}},H=()=>{const t=f.value,e=D.value.filter(l=>l.start_time.split("T")[0]===t);g.total=e.length,g.confirmed=e.filter(l=>l.status==="confirmed").length,g.inProgress=e.filter(l=>{const r=new Date,v=new Date(l.start_time),m=new Date(l.end_time);return r>=v&&r<=m&&l.status==="confirmed"}).length,g.available=C.value.filter(l=>l.is_available).length},W=t=>{const e=new Date;return e.getHours()===t&&e.toISOString().split("T")[0]===f.value},I=t=>`${t.toString().padStart(2,"0")}:00`,V=t=>new Date(t).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),Y=t=>new Date(t).toLocaleString("zh-CN",{hour:"2-digit",minute:"2-digit"}),L=t=>{const e=Y(t.start_time),l=Y(t.end_time);return`${e}-${l}`},X=t=>{if(!t.is_available)return"status-unavailable";const e=new Date;return e.getHours(),D.value.some(r=>{if(r.resource_name!==t.name)return!1;const v=new Date(r.start_time),m=new Date(r.end_time);return e>=v&&e<=m&&r.status==="confirmed"})?"status-busy":"status-available"},J=t=>{if(!t.is_available)return"维护中";const e=new Date;return D.value.some(r=>{if(r.resource_name!==t.name)return!1;const v=new Date(r.start_time),m=new Date(r.end_time);return e>=v&&e<=m&&r.status==="confirmed"})?"使用中":"空闲"},K=(t,e)=>{if(!C.value.find(v=>v.id===t))return"";const r=h(t,e);return r?`slot-reserved slot-${r.status}`:"slot-available"},h=(t,e)=>{const l=C.value.find(r=>r.id===t);return l?D.value.find(r=>{if(r.resource_name!==l.name)return!1;const v=new Date(r.start_time),m=new Date(r.end_time),R=new Date(f.value+` ${e}:00:00`);return R>=v&&R<m}):null},Z=(t,e)=>{const l=h(t,e);return l?`${l.title}
${L(l)}
预约人: ${l.user_name}`:""},j=t=>{const e={待审批:"warning",已批准:"success",已拒绝:"danger",已取消:"info",已完成:"success"};return e[t]?e[t]:{pending:"warning",approved:"success",rejected:"danger",cancelled:"info",completed:"success"}[t]||"info"},A=t=>["待审批","已批准","已拒绝","已取消","已完成"].includes(t)?t:{pending:"待审批",approved:"已批准",rejected:"已拒绝",cancelled:"已取消",completed:"已完成"}[t]||t,ee=(t,e)=>{const l=h(t.id,e);l?O(l):z.info(`点击了 ${t.name} 的 ${I(e)} 时段`)},O=t=>{c.value=t,x.value=!0};return de(()=>{Q(),k(),setInterval(()=>{k()},6e4)}),(t,e)=>{const l=we,r=ye,v=be,m=ve,R=_e,w=fe,P=ge,te=he,se=ce,b=Re,ae=ke,ne=ue,le=pe;return _(),p("div",Te,[n(se,{class:"panel-card",shadow:"hover"},{header:o(()=>[s("div",Ee,[n(l,null,{default:o(()=>[n(E(De))]),_:1}),e[3]||(e[3]=s("span",null,"会议室预约面板",-1)),s("div",Me,[n(r,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:k},null,8,["modelValue"]),n(v,{type:"primary",icon:E(Ce),onClick:k},{default:o(()=>[...e[2]||(e[2]=[u(" 刷新 ",-1)])]),_:1},8,["icon"])])])]),default:o(()=>[s("div",$e,[n(R,{gutter:20},{default:o(()=>[n(m,{span:6},{default:o(()=>[s("div",xe,[s("div",Ve,i(g.total),1),e[4]||(e[4]=s("div",{class:"stat-label"},"总预约数",-1))])]),_:1}),n(m,{span:6},{default:o(()=>[s("div",Ye,[s("div",Pe,i(g.confirmed),1),e[5]||(e[5]=s("div",{class:"stat-label"},"已确认",-1))])]),_:1}),n(m,{span:6},{default:o(()=>[s("div",ze,[s("div",Be,i(g.inProgress),1),e[6]||(e[6]=s("div",{class:"stat-label"},"进行中",-1))])]),_:1}),n(m,{span:6},{default:o(()=>[s("div",Ne,[s("div",He,i(g.available),1),e[7]||(e[7]=s("div",{class:"stat-label"},"可用会议室",-1))])]),_:1})]),_:1})]),s("div",Ie,[e[8]||(e[8]=s("h3",null,"今日预约时间轴",-1)),s("div",Le,[s("div",je,[(_(!0),p(S,null,T(E(N),a=>(_(),p("div",{key:a,class:B(["time-slot",{"current-hour":W(a)}])},[s("div",Ae,i(I(a)),1)],2))),128))]),s("div",Oe,[(_(!0),p(S,null,T(C.value,a=>(_(),p("div",{key:a.id,class:"room-timeline"},[s("div",Ue,[s("div",Fe,i(a.name),1),s("div",qe,i(a.capacity)+"人",1),s("div",{class:B(["room-status",X(a)])},i(J(a)),3)]),s("div",Ge,[(_(!0),p(S,null,T(E(N),d=>{var U;return _(),p("div",{key:d,class:B(["timeline-slot",K(a.id,d)]),onClick:nt=>ee(a,d)},[h(a.id,d)?(_(),p("div",{key:0,class:"reservation-block",title:Z(a.id,d)},[s("div",Xe,i((U=h(a.id,d))==null?void 0:U.title),1),s("div",Je,i(h(a.id,d)?L(h(a.id,d)):""),1)],8,We)):M("",!0)],10,Qe)}),128))])]))),128))])])]),s("div",Ke,[e[10]||(e[10]=s("h3",null,"当日预约详情",-1)),me((_(),q(te,{data:G.value,"max-height":"400"},{default:o(()=>[n(w,{prop:"title",label:"会议主题","min-width":"150"}),n(w,{prop:"resource_name",label:"会议室",width:"120"}),n(w,{label:"时间",width:"200"},{default:o(({row:a})=>[u(i(V(a.start_time))+" - "+i(Y(a.end_time)),1)]),_:1}),n(w,{prop:"user_name",label:"预约人",width:"100"}),n(w,{label:"状态",width:"100"},{default:o(({row:a})=>[n(P,{type:j(a.status)},{default:o(()=>[u(i(A(a.status)),1)]),_:2},1032,["type"])]),_:1}),n(w,{label:"参与人数",width:"100"},{default:o(({row:a})=>{var d;return[u(i(((d=a.participants)==null?void 0:d.length)||0)+"人 ",1)]}),_:1}),n(w,{label:"操作",width:"120"},{default:o(({row:a})=>[n(v,{size:"small",onClick:d=>O(a)},{default:o(()=>[...e[9]||(e[9]=[u("详情",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,$.value]])])]),_:1}),n(ne,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),title:"预约详情",width:"600px"},{default:o(()=>{var a;return[c.value?(_(),p("div",Ze,[n(ae,{column:2,border:""},{default:o(()=>[n(b,{label:"预约编号"},{default:o(()=>[u(i(c.value.id),1)]),_:1}),n(b,{label:"会议主题"},{default:o(()=>[u(i(c.value.title),1)]),_:1}),n(b,{label:"会议室"},{default:o(()=>[u(i(c.value.resource_name),1)]),_:1}),n(b,{label:"预约人"},{default:o(()=>[u(i(c.value.user_name),1)]),_:1}),n(b,{label:"开始时间"},{default:o(()=>[u(i(V(c.value.start_time)),1)]),_:1}),n(b,{label:"结束时间"},{default:o(()=>[u(i(V(c.value.end_time)),1)]),_:1}),n(b,{label:"状态"},{default:o(()=>[n(P,{type:j(c.value.status)},{default:o(()=>[u(i(A(c.value.status)),1)]),_:1},8,["type"])]),_:1}),n(b,{label:"参与人数"},{default:o(()=>{var d;return[u(i(((d=c.value.participants)==null?void 0:d.length)||0)+"人",1)]}),_:1})]),_:1}),c.value.description?(_(),p("div",et,[e[11]||(e[11]=s("h4",null,"会议描述",-1)),s("p",null,i(c.value.description),1)])):M("",!0),(a=c.value.participants)!=null&&a.length?(_(),p("div",tt,[e[12]||(e[12]=s("h4",null,"参与人员",-1)),(_(!0),p(S,null,T(c.value.participants,d=>(_(),q(P,{key:d,class:"participant-tag"},{default:o(()=>[u(i(d),1)]),_:2},1024))),128))])):M("",!0)])):M("",!0)]}),_:1},8,["modelValue"])])}}}),ot=Se(st,[["__scopeId","data-v-6d64dbc0"]]);export{ot as default};
