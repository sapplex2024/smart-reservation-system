import{d as X,u as Y,r as d,c as Z,o as ee,a as A,b as c,e as a,w as l,E as ae,f as le,g as $,h as m,i as te,j as oe,k as g,s as se,l as ne,p as ie,m as i,n as re,q as ue,v as de,t as L,x as ce,y as me,z as w,A as pe,F as _e,B as fe,C as ve,D as be,G as ge,H as we,I as ye,J as xe,K as Ve,L as ke,M as Ce,N as D,O as F,_ as $e}from"./index-C-Q3ynzh.js";const Ee={class:"room-management-view"},he={class:"action-bar"},Be={class:"search-section"},Fe={class:"button-section"},Re={class:"room-name"},ze={class:"features-tags"},Te=X({__name:"RoomManagementView",setup(Ue){const y=Y(),E=d(!1),R=d(!1),f=d(!1),v=d(null),h=d(""),z=d([]),x=d([]),B=d(),r=d({name:"",capacity:10,location:"",description:"",is_available:!0}),I={name:[{required:!0,message:"请输入会议室名称",trigger:"blur"},{min:2,max:50,message:"名称长度在 2 到 50 个字符",trigger:"blur"}],capacity:[{required:!0,message:"请输入容量",trigger:"blur"},{type:"number",min:1,max:100,message:"容量必须在 1 到 100 之间",trigger:"blur"}],location:[{required:!0,message:"请输入位置",trigger:"blur"}]},M=Z(()=>{if(!h.value)return z.value;const o=h.value.toLowerCase();return z.value.filter(e=>e.name.toLowerCase().includes(o)||e.location.toLowerCase().includes(o))}),V=async()=>{var o,e;E.value=!0;try{const s=await $.get("/api/resources/",{params:{resource_type:"meeting_room"},headers:{Authorization:`Bearer ${y.token}`}});z.value=s.data}catch(s){m.error(`加载会议室列表失败: ${((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.detail)||s.message}`)}finally{E.value=!1}},U=o=>o?Object.entries(o).filter(([e,s])=>s).map(([e,s])=>e):[],q=o=>{v.value=o,r.value={name:o.name,capacity:o.capacity,location:o.location,description:o.description||"",is_available:o.is_available},x.value=U(o.features),f.value=!0},N=()=>{var o;v.value=null,r.value={name:"",capacity:10,location:"",description:"",is_available:!0},x.value=[],(o=B.value)==null||o.resetFields()},S=async()=>{var o,e;if(B.value){try{await B.value.validate()}catch{return}R.value=!0;try{const s={};["投影仪","白板","电视","音响","视频会议","空调","WiFi"].forEach(k=>{s[k]=x.value.includes(k)});const u={...r.value,type:"meeting_room",features:s};v.value?(await $.put(`/api/resources/${v.value.id}`,u,{headers:{Authorization:`Bearer ${y.token}`}}),m.success("会议室更新成功")):(await $.post("/api/resources/",u,{headers:{Authorization:`Bearer ${y.token}`}}),m.success("会议室添加成功")),f.value=!1,await V()}catch(s){m.error(`保存失败: ${((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.detail)||s.message}`)}finally{R.value=!1}}},W=async o=>{var e,s;try{const n=o.is_available?"禁用":"启用";await D.confirm(`确定要${n}会议室 "${o.name}" 吗？`,`确认${n}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await $.put(`/api/resources/${o.id}`,{is_available:!o.is_available},{headers:{Authorization:`Bearer ${y.token}`}}),m.success(`会议室${n}成功`),await V()}catch(n){n!=="cancel"&&m.error(`操作失败: ${((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.detail)||n.message}`)}},j=async o=>{var e,s;try{await D.confirm(`确定要删除会议室 "${o.name}" 吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await $.delete(`/api/resources/${o.id}`,{headers:{Authorization:`Bearer ${y.token}`}}),m.success("会议室删除成功"),await V()}catch(n){n!=="cancel"&&m.error(`删除失败: ${((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.detail)||n.message}`)}};return ee(()=>{V()}),(o,e)=>{const s=oe,n=te,u=ne,k=ae,p=ce,T=pe,G=ge,b=ye,O=xe,_=ke,H=Ve,J=Ce,K=we,Q=le,P=de;return F(),A("div",Ee,[e[22]||(e[22]=c("div",{class:"page-header"},[c("h1",{class:"page-title"},"会议室管理"),c("p",{class:"page-subtitle"},"管理会议室资源，配置数量、名称、位置等信息")],-1)),a(k,{class:"action-card",shadow:"hover"},{default:l(()=>[c("div",he,[c("div",Be,[a(n,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:"搜索会议室名称或位置",style:{width:"300px"},clearable:""},{prefix:l(()=>[a(s,null,{default:l(()=>[a(g(se))]),_:1})]),_:1},8,["modelValue"])]),c("div",Fe,[a(u,{type:"primary",onClick:e[1]||(e[1]=t=>f.value=!0),icon:g(ie)},{default:l(()=>[...e[10]||(e[10]=[i(" 添加会议室 ",-1)])]),_:1},8,["icon"]),a(u,{type:"success",onClick:V,loading:E.value,icon:g(re)},{default:l(()=>[...e[11]||(e[11]=[i(" 刷新 ",-1)])]),_:1},8,["loading","icon"])])])]),_:1}),a(k,{class:"table-card",shadow:"hover"},{default:l(()=>[ue((F(),L(G,{data:M.value,style:{width:"100%"},"empty-text":"暂无会议室数据"},{default:l(()=>[a(p,{prop:"name",label:"会议室名称",width:"200"},{default:l(t=>[c("div",Re,[a(s,{class:"room-icon"},{default:l(()=>[a(g(me))]),_:1}),c("span",null,w(t.row.name),1)])]),_:1}),a(p,{prop:"capacity",label:"容量",width:"100"},{default:l(t=>[a(T,{type:"info"},{default:l(()=>[i(w(t.row.capacity)+"人",1)]),_:2},1024)]),_:1}),a(p,{prop:"location",label:"位置",width:"200"}),a(p,{prop:"description",label:"描述","show-overflow-tooltip":""}),a(p,{prop:"features",label:"设备",width:"200"},{default:l(t=>[c("div",ze,[(F(!0),A(_e,null,fe(U(t.row.features),C=>(F(),L(T,{key:C,size:"small",style:{"margin-right":"5px","margin-bottom":"2px"}},{default:l(()=>[i(w(C),1)]),_:2},1024))),128))])]),_:1}),a(p,{prop:"is_available",label:"状态",width:"100"},{default:l(t=>[a(T,{type:t.row.is_available?"success":"danger"},{default:l(()=>[i(w(t.row.is_available?"可用":"不可用"),1)]),_:2},1032,["type"])]),_:1}),a(p,{label:"操作",width:"200",fixed:"right"},{default:l(t=>[a(u,{size:"small",type:"primary",onClick:C=>q(t.row),icon:g(ve)},{default:l(()=>[...e[12]||(e[12]=[i(" 编辑 ",-1)])]),_:2},1032,["onClick","icon"]),a(u,{size:"small",type:t.row.is_available?"warning":"success",onClick:C=>W(t.row)},{default:l(()=>[i(w(t.row.is_available?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),a(u,{size:"small",type:"danger",onClick:C=>j(t.row),icon:g(be)},{default:l(()=>[...e[13]||(e[13]=[i(" 删除 ",-1)])]),_:2},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[P,E.value]])]),_:1}),a(Q,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=t=>f.value=t),title:v.value?"编辑会议室":"添加会议室",width:"600px",onClose:N},{footer:l(()=>[a(u,{onClick:e[8]||(e[8]=t=>f.value=!1)},{default:l(()=>[...e[21]||(e[21]=[i("取消",-1)])]),_:1}),a(u,{type:"primary",onClick:S,loading:R.value},{default:l(()=>[i(w(v.value?"更新":"添加"),1)]),_:1},8,["loading"])]),default:l(()=>[a(K,{ref_key:"roomFormRef",ref:B,model:r.value,rules:I,"label-width":"100px"},{default:l(()=>[a(b,{label:"会议室名称",prop:"name"},{default:l(()=>[a(n,{modelValue:r.value.name,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.name=t),placeholder:"请输入会议室名称"},null,8,["modelValue"])]),_:1}),a(b,{label:"容量",prop:"capacity"},{default:l(()=>[a(O,{modelValue:r.value.capacity,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.capacity=t),min:1,max:100,placeholder:"请输入容量",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(b,{label:"位置",prop:"location"},{default:l(()=>[a(n,{modelValue:r.value.location,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.location=t),placeholder:"请输入会议室位置"},null,8,["modelValue"])]),_:1}),a(b,{label:"描述"},{default:l(()=>[a(n,{modelValue:r.value.description,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.description=t),type:"textarea",rows:3,placeholder:"请输入会议室描述"},null,8,["modelValue"])]),_:1}),a(b,{label:"设备"},{default:l(()=>[a(H,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=t=>x.value=t)},{default:l(()=>[a(_,{label:"投影仪"},{default:l(()=>[...e[14]||(e[14]=[i("投影仪",-1)])]),_:1}),a(_,{label:"白板"},{default:l(()=>[...e[15]||(e[15]=[i("白板",-1)])]),_:1}),a(_,{label:"电视"},{default:l(()=>[...e[16]||(e[16]=[i("电视",-1)])]),_:1}),a(_,{label:"音响"},{default:l(()=>[...e[17]||(e[17]=[i("音响",-1)])]),_:1}),a(_,{label:"视频会议"},{default:l(()=>[...e[18]||(e[18]=[i("视频会议",-1)])]),_:1}),a(_,{label:"空调"},{default:l(()=>[...e[19]||(e[19]=[i("空调",-1)])]),_:1}),a(_,{label:"WiFi"},{default:l(()=>[...e[20]||(e[20]=[i("WiFi",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"状态"},{default:l(()=>[a(J,{modelValue:r.value.is_available,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value.is_available=t),"active-text":"可用","inactive-text":"不可用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Le=$e(Te,[["__scopeId","data-v-2bc1a6eb"]]);export{Le as default};
